The `application-connectors` bucket contains diverse generic application connectors for the most frequently used cloud data management systems (ERP, ETL, LDAP, Reporting and Monitoring, and ServiceNow).The aim of an application connector is to facilitate and simplify the integration of a cloud application in your workflows.

=== ETL

The ETL connectors allow connecting to data servers and benefit from their features.
The following presents the various ETL connectors that PWS handle.

==== Informatica

The Informatica workflow consists of one task.

*Variables:*

The Informatica workflow consists of a list of variables described in the following table.

.Informatica Connector variables
[cols="2,5,2,2,2,2"]
|===
| *Variable name* | *Description* | *Scope* | *Required?*  | *Type*  | *Default/Examples*
| `ENDPOINT`
| Server host.
| Workflow
| Yes
| String
| e.g. `\https://xxx.informaticacloud.com/test/test`
| `USERNAME`
| Username to use for the authentication.
| Workflow
| No
| String
| e.g. toto
| `PASSWORD`
| Password to use for the authentication.
| Workflow
| No
| String
| e.g. toto
| `RESPONSE_FORMAT`
| Format of the server response .
| Task
| Yes
| string, json, xml, html, contentView
| json
| `RESPONSE_PATH`
| ...
| Task
| Yes
| String
| .
| `PARAM_var`
| Name of the api parameter (in case of multiple parameters, add several parameters fields).
| Task
| No
| String
| e.g. PARAM_input
| `HEADER_header`
| Name of the api request header (in case of multiple parameters, add several headers fields).
| Task
| No
| String
| e.g. HEADER_sessionId
| `JWT_TOKEN`
| JWT Token to use for the authentication.
| Workflow
| No
| String
| e.g. eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9
| `DEBUG`
| Allows printing more logs in the workflow results.
| Task
| Yes
| Boolean
| False
|===

*How to use this task:*

This WorkFlow performs a GET request to an Informatica API associated to an application already created by the Informatica user.
This workflow template supports the following authentication methods: a basic authentication using a username and a password, an advanced authentication using a JWT access token and finally an anonymous authentication where no authorization is required.
The authentication method is determined based on the definition of the parameters when launching the WF.


[#_servicenow]
=== ServiceNow

The ServiceNow connectors allow ProActive to communicate with ServiceNow instances to perform CRUD operations on their data as well as to send emails.

The installation of the ProActive application in ServiceNow, which enables a ServiceNow instance to communication with a ProActive server, is described
in the link:../admin/ProActiveAdminGuide.adoc#_servicenow_integration[ServiceNow admin documentation].

==== ProActive to ServiceNow

A set of ProActive workflow templates are available in the catalog to communicate with ServiceNow.
They are usually integrated as a task or a subworkflow in an end-to-end workflow and perform
HTTP queries to ServiceNow's TABLE or EMAIL API depending on their action.

Go to link:https://docs.servicenow.com/en-US/bundle/quebec-application-development/page/build/applications/concept/api-rest.html[ServiceNow's REST API reference, window="_blank"] for the complete API's documentation.

===== Send Emails

This workflow enables to send emails through ServiceNow using the EMAIL API.

It is made of a single task with its variables.

*Task Variables:*

.ServiceNow_Send_Email
[cols="2,5,2,2,2"]
|===
| *Variable name* | *Description* | *Required?*  | *Type*  | *Default/Examples*
| `ENDPOINT`
| ServiceNow server endpoint.
| Yes
| URL
| `https://SN_SERVER/api/now/v1/email`
| `USER`
| ServiceNow user.
| Yes
| String
| e.g. administrator
| `PASSWORD`
| ServiceNow password.
| Yes
| Sring (HIDDEN)
| e.g. PWD
| `TO`
| Recipients of the email.
| Yes
| String as a comma separated list
| e.g. `example@emailexample.com,example2@emailexample.com`
| `CC`
| Email addresses that will be in copy.
| No
| String as a comma separated list
| e.g. `example@emailexample.com,example2@emailexample.com`
| `SUBJECT`
| The subject of the email.
| No
| String
| e.g. `Email from ProActive about ...`
| `HTML`
| Content of the email, can contain HTML tags
| Yes
| String with HTML
| e.g. `<bold> This content has been generated by proactive </bold>`
| `TABLE_NAME`
| Name of the table to save the email. Use this parameter to associate an email message to a particular related record elsewhere in the system.
| No
| String with HTML
| e.g. incident
| `TABLE_RECORD_ID`
| Target-related record to which the email applies. Use this parameter to associate an email message to a particular related record elsewhere in the system.
| No
| String
| e.g. 9d385017c611228701d22104cc95c371
| `SSL_DISABLE_CHECK`
| If true, disables SSL certificate verification
| No
| Boolean
| e.g. true
| `CONTENT_TYPE`
| Content-type of the request, should be 'application/json' with eventual encoding.
| Yes
| String
| e.g. `application/json;charset = UTF-8`
| `REQUEST_BODY`
| The body of the HTTP request which is automatically built.
| Yes
| String
| e.g. `{"to":"","cc":"","subject":"${SUBJECT}","html":"${HTML}"}`
| `DEBUG`
| If true, activates the debug mode which prints messages to the terminal.
| No
| Boolean
| e.g. `true`
|===

===== Table API

The TABLE API allows to query data from a ServiceNow instance.

There are six workflows in ProActive's Catalog that queries ServiceNow's TABLE API. Two enables to create a ServiceNow task
and mark it as resolved and four other to perform basic CRUD operations on ServiceNow's tables.

The two Task related workflows have both one task with the following variables:

.ServiceNow_Create_Task
[cols="2,5,2,2,2"]
|===
| *Variable name* | *Description* | *Required?*  | *Type*  | *Default/Examples*
| `ENDPOINT`
| ServiceNow server endpoint.
| Yes
| URL
| `https://SN_SERVER/api/now`
| `USER`
| ServiceNow user.
| Yes
| String
| e.g. administrator
| `PASSWORD`
| ServiceNow password.
| Yes
| Sring (HIDDEN)
| e.g. PWD
| `TASK_TYPE`
| The subtype of the ServiceNow Task
| Yes
| PA:LIST(incident,ticket,problem,change_request)
| e.g. `incident`
| `PATH`
| The path of the query
| Yes
| String
| e.g. `/table/${TASK_TYPE}`
| `RETURNED_FIELDS`
| ServiceNow data to be returned in the HTTP response
| No
| String as a comma separated list
| e.g. `number,sys_created_on,assigned_to,short_description,description,priority,sys_id`
| `SSL_DISABLE_CHECK`
| If true, disables SSL certificate verification
| No
| Boolean
| e.g. true
| `CONTENT_TYPE`
| Content-type of the request, should be 'application/json' with eventual encoding.
| Yes
| String
| e.g. `application/json;charset = UTF-8`
| `REQUEST_BODY`
| The body of the HTTP request which is automatically built.
| Yes
| String
| e.g. `{"to":"","cc":"","subject":"${SUBJECT}","html":"${HTML}"}`
| `DEBUG`
| If true, activates the debug mode which prints messages to the terminal.
| No
| Boolean
| e.g. `true`
| `RESPONSE_PATH`
| The path of the data to extract in the response if json, xml or html format is selected
| Yes
| String
| e.g. `.`
|===

Mark a ServiceNow Task as resolved requires in addition to the variables described in the Create Task workflow:

.ServiceNow_Mark_Task_As_Resolved
[cols="2,5,2,2,2"]
|===
| *Variable name* | *Description* | *Required?*  | *Type*  | *Default/Examples*
| `STATE_NOTE`
| A note binded to the task resolution
| Yes
| String
| `The task has been resolved`
| `STATE`
| The state of the ServiceNow Task after resolution. Can be 6 = Resolved, or 7 = Closed
| Yes
| Integer
| e.g. `6`
| `CLOSED_BY`
| The user who resolved the Task
| Yes
| Sring
| e.g. `administrator`
| `SYS_ID`
| The system id of the Task to be resolved
| Yes
| String
| e.g. `sys_9d385017c611228701d22104cc95c371`
|===

The other four generic workflows to perform CRUD have the following structure.

*Workflow variables:*

.ServiceNow_CRUD_workflow_variables
[cols="2,5,2,2,2"]
|===
| *Variable name* | *Description* | *Required?*  | *Type*  | *Default/Examples*
| `SERVICENOW_BASE_URL`
| Base URL of the ServiceNow instance
| Yes
| String
| `https://SN_SERVER.com`
| `SERVICENOW_USER`
| ServiceNow user
| Yes
| String
| e.g. `administrator`
| `SERVICENOW_PASSWORD`
| ServiceNow password
| Yes
| Sring (HIDDEN)
|===

*Task variables:*

.ServiceNow_CRUD_task_variables
[cols="2,5,2,2,2"]
|===
| *Variable name* | *Description* | *Required?*  | *Type*  | *Default/Examples*
| `ENDPOINT`
| Queried endpoint of the TABLE API
| Yes
| String
| `${SERVICENOW_BASE_URL}/api/now/table/${TABLE_NAME}`
| `TABLE_NAME`
| Name of queried ServiceNow table
| Yes
| String
| e.g. `incident`
| `REQUEST_BODY`
| JSON structure describing columns and their values to be inserted
| Yes
| String
| `{"column1":"value1", "column2":"value2",...}`
| `TABLE_NAME`
| Name of the queried ServiceNow table
| Yes
| String
| e.g. `incident`
| `RESPONSE_FORMAT`
| Format of the HTTP response
| Yes
| String
| e.g. `application/json`
| `RESPONSE_PATH`
| Path of the data to extract in the response if json, xml or html format is selected
| Yes
| String
| e.g. `.`
| `REQUEST_FORMAT`
| Format of the HTTP request
| Yes
| String
| e.g. `application/json`
| `SYS_ID`
| Id of the row to query (needed for read, update, delete)
| Yes
| String
| e.g. `sys_9d385017c611228701d22104cc95c371`
| `HTTP_METHOD`
| HTTP Method of the query. Used for the update or modify record workflow
| Yes
| String
| e.g. `PATCH`
| `SYSPARM_DISPLAY_VALUE`
| Returns field display values (true), actual values (false), or both (all).
| Yes
| Boolean
| e.g. `true`
| `SYSPARM_EXCLUDE_REFERENCE_LINK`
| True to exclude Table API links for reference fields.
| Yes
| Boolean
| e.g. `false`
| `SYSPARM_FIELDS`
| Fields of the table to be included in the response
| Yes
| String as a comma separated list
| e.g. `sys_id`
| `SYSPARM_INPUT_DISPLAY_VALUE`
| Set field values using their display value (true) or actual value (false)
| Yes
| Boolean
| e.g. `false`
| `SYSPARM_SUPPRESS_AUTO_SYS_FIELD`
| True to suppress auto generation of system fields
| Yes
| Boolean
| e.g. `false`
| `SYSPARM_QUERY_NO_DOMAIN`
| True to access data across domains if authorized
| Yes
| Boolean
| e.g. `false`
| `SSL_DISABLE_CHECK`
| If true, disables SSL certificate verification
| No
| Boolean
| e.g. true
| `DEBUG`
| If true, activates the debug mode which prints messages to the terminal.
| No
| Boolean
| e.g. `true`
|===

==== ServiceNow to ProActive

Once the application is installed, you are ready to integrate ProActive in your ServiceNow pipelines.

We will go over the core application files in the application to explain how to use them.

===== Script Includes

====== Overview

As defined by ServiceNow, Script Includes are reusable server-side scripts logic that define a function or a class.
Script Includes execute their script logic only when explicitly called by other scripts anywhere in the application where scripting is permitted.

It can be in another Script Include, In Workflow Activities, Flow Actions, UI elements ...

====== Usage

Calling a Script Include where scripting is enabled is very easy. You just need to create an instance of the Script Include and execute its functions.

Here is an example where the Script Include named SchedulerClient is called in a Flow's Action to submit a job:

[[submit_from_catalog_script_code]]
[source,javascript]
----
(function execute(inputs, outputs) {

    var schedulerClient = new SchedulerClient();
    var response = schedulerClient.submitJobFromCatalog(inputs.proactive_url, inputs.session_id, inputs.bucket_name, inputs.workflow_name, inputs.variables, inputs.generic_info);

    outputs.job_id = response.id;
    outputs.readable_name = response.readableName;

})(inputs, outputs);
----

====== ProActive's application Script Includes

There are 3 script includes in the ProActive application:

*SchedulerClient*: A client that makes REST calls to a ProActive's Scheduler.
Call this Script Include to make HTTP requests to the Scheduler of a ProActive's server.

Here is the list of its current functions.

TIP: The REST API documentation for our try platform is available at https://try.activeeon.com/doc/rest/

[cols="1,1,1,1"]
|===
|Function name | Action | Inputs | Output

|getSessionId
|Executes a POST request to login and retrieve the sessionId of a ProActive user
a|
* proActiveUrl: Root URL of ProActive server
* username: Name of user
* password: Password of user
|The session id associated to the user

|restartInErrorTasks
|Executes a PUT request to restart all tasks in error in the job represented by a job id
a|
* jobId: Id of the job to restart in error tasks
|True if success, false if not

|submitJobFromCatalog
|Submits a job to the scheduler from the catalog, creating a new job resource
a|
* proactiveUrl: URL of the ProActive installation folder
* sessionId: sessiondId of the user that will submit the job
* bucket: Bucket name of the workflow
* workflow: Name of the workflow
* workflowVariables: Variables of the workflow as a JSON
* genericInfos: Generic informations of the workflow as JSON
a|The jobid of the newly created job as JSON

[source,json]
----
{
  readableName:string,
  id:integer
}
----

|submitJobFromFile
|Submits a workflow stored in the ServiceNow instance to ProActive's scheduler, creating a new job resource.
Provided a workflow name, the script will search for the corresponding workflow stored in ProActive's application table named "x_661207_proacti_0_workflow" and labeled "Workflow".
The workflow's must be stored as a file that complies with ProActive's xref:../user/ProActiveUserGuide.adoc#_job_and_task_specification[XML schema].
a|
* proactiveUrl: Root URL of ProActive server
* sessionId: Session id of the ProActive who submits the job
* workflowName: Name of the workflow to submit, stored in the Workflow table
* variables: Variables of the workflow as JSON
a|The jobid of the newly created job as JSON

[source,json]
----
{
  readableName:string,
  id:integer
}
----

|disconnectUser
|Executes a PUT request to disconnect a user represented by a sessionId from a ProActive server
a|
* proactiveUrl: Root URL of ProActive server
* sessionId: Session id of the user to disconnect
|True if successful else false

|getJobInfo
|Executes a GET request to retrieve a job's job info
a|
* proactiveUrl: Root URL of ProActive server
* sessionId: Session id of the ProActive user
|True if successful, else false

|isFaultyJob
|Executes the getJobInfo function and checks the current job status to determine if the job is Faulty.
A job is considered faulty when it is finished, canceled or failed and has at least one task that is failed, faulty or in error
a|
* proactiveUrl: Root URL of ProActive server
* sessionId: Session id of the ProActive user
* jobId: Id of the job to test
|True if the job is faulty, else false

|waitForTerminalStatus
|Polling function that blocks the current thread and checks the current job status every 2.5 seconds until it reaches a terminal status.
a|
* proactiveUrl: Root URL of ProActive server
* sessionId: Session id of the ProActive user
* jobId: Id of the job to poll
|The polled job info

|_getAllJobStatuses
|Utility function that returns a mapping of all the possible job statuses and if it is a terminal status
|
a|
[source,json]
----
{
    'PENDING': true,
    'RUNNING': true,
    'STALLED': true,
    'FINISHED': false,
    'PAUSED': true,
    'CANCELED': false,
    'FAILED': false,
    'KILLED': false,
    'IN_ERROR': true
}
----
|Cell in column 4, row 3
|===

NOTE: Functions starting with an _ is a ServiceNow naming convention for private functions. This is purely informative
as in reality they are callable from anywhere like other functions.

*OutboundRestService*: A service class that contains a utility function to execute a ServiceNow's Outbound Rest Messages.
Used by the SchedulerClient, it encapsulates the procedure to build and execute an HTTP query to ProActive's Scheduler.

Like the SchedulerClient class, its function can be called from anywhere scripting is permitted.

[cols="1,1,1,1"]
|===
|Function name | Action | Inputs | Output

| executeOutboundRestMsg
| Prepares and executes a ServiceNow HTTP Method from the ProActive Scheduler REST Message
a|
* proActiveUrl: Root URL of ProActive server
* sessionId: Session id of the ProActive user
* httpMethodName: Name of the HTTP Method to execute
* httpMethodVariables: A JSON collection of name/value pairs which holds the name of the HTTP Method variable to replace and its value.
This stands for all HTTP params types (including variables in the body) except query params which are defined in the following variable.
* queryParams: A JSON collection of name/value pairs which holds the name of the query param to replace and its value.
| A RESTResponseV2 object. Go to ServiceNow's link:https://developer.servicenow.com/dev.do#!/reference/api/quebec/server/sn_ws-namespace/c_RESTResponseV2API[RESTResponseV2 API documentation]
to get a list of its functions.
|Cell in column 4, row 3
|===

*JobRepository*: It is the service class which holds functions to perform CRUD operations on the application's table labeled "Submitted job".
A table is a collection of records in the database. Each record corresponds to a row in a table, and each field on a record corresponds to a column on that table.
The Submitted Job table can be used to store Job Info data received from ProActive and access it in your pipelines.
Like other Script Include, it can be instantiated and called anywhere scripting is permitted.

You will find in the next section the structure of the table, which corresponds to JobInfo data fields returned by the Scheduler.

Here is the list of the current available functions

[cols="1,1,1,1"]
|===
|Function name | Action | Inputs | Output

| createSubmittedJob
| Adds a row to the Submitted Job table
a|
* sessionId: Session id of the ProActive user
* jobInfo: JobInfo data object to insert in the table
| The sys id of the created row

| updateSubmittedJob
| updates a row to the Submitted Job table
a|
* sessionId: Session id of the ProActive user
* jobInfo: Complete JobInfo data object with updated fields.
| True if the update has succeeded, else false

| deleteSubmittedJobBySysId
| Deletes a row which has the specified sys id
a|
* sysId: The sys id of the row to be deleted
| True if the deletion has succeeded, else false

| deleteSubmittedJobByJobId
| Deletes a row which has the specified job id
a|
* jobId: The id of the job to be deleted
| True if the deletion has succeeded, else false

| _isJobExists
| Checks if a row exists with the specified job id
a|
* jobId: The id of the job to check
| True if the row exists, else false

| _executeUpdateQuery
| Utility function to encapsulate the update of a row process
a|
* jobId: The id of the job to be updated
| True if the update has succeeded, else false
|Cell in column 4, row 3
|===

===== Tables

The application has two tables that can be used to store and read data:

. *Submitted Job*: Each row contains data of a job submitted to the Scheduler.
This is the table used by the JobRepository Script Include to perform CRUD operations.
. *Workflow*: Each row contains a ProActive workflow xml definition file. The function submitJobFromFile of the SchedulerService Script Include
will search for the specified workflow's XML definition in this table.

Below you will find the structure of both tables

.Structure of the Submitted Job table
[cols="1,1,1"]
|===
|Column name | Type | Max length

| finished_time
| Long
| 40

| in_error_time
| Long
| 40

| job_id
| Long
| 40

| name
| String
| 256

| output
| String
| 4000

| owner
| String
| 40

| result
| String
| 40

| session_id
| String
| 64

| start_time
| Long
| 40

| status
| String
| 16

| submitted_time
| Long
| 40
|===

.Structure of the Workflow table
[cols="1,1,1"]
|===
|Column name | Type | Max length

| name
| String
| 256

| file
| File Attachment
| 40

|Cell in column 4, row 3
|===

NOTE: All tables contain additional fields starting with sys_ . Those fields are automatically generated by ServiceNow when the table is created and can't be changed.

Two Table Columns have been added to the Incident table:

. ProActive Job Id
. ProActive Session Id

This allows to specify the sessionId of the user, and a job id at an Incident creation, binding it to a ProActive job.
Other columns can be added in the Incident table to store logs, outputs or any needed information regarding a job.

===== Flow Designer

Flow Designer is a feature for automating processes in a single design environment.

Actions and Core Actions are what composes a Flow and Subflow. The application comes with Actions ready to be used.
These Actions use the Script Includes that we described earlier.

An Action consists of:

- Inputs: Variables accessible from all steps of the action
- Action step(s): Process(es) using the provided inputs
- Outputs: Variables that represent the results of the action. These results are available to other actions in a flow.

ProActive's application Actions have been designed so that their inputs correspond to the related function called from
the Scheduler Client Script Include to make it as linear as possible.

.Available actions
[.center, cols="1", width=25%]
|===
|Action name

| Login to ProActive
| Disconnect from ProActive
| Submit job from catalog
| Submit job from file
| Wait for terminal status
| Disconnect from ProActive
|===

Here is an example with the "Submit From Catalog" action. It applies to other actions as well.

.Inputs of the Submit From Catalog action
image::servicenow-action-inputs.png[align="center"]

The Action inputs are accessible by all steps of the Action

Inputs of this step are bound to the Action inputs. This is represented by a pill
in the "Value" column.

.Inputs of the Submit From Catalog script step
image::servicenow-step-inputs.png[align="center"]

The action is composed of a single script step. A script step is JavaScript code to execute within a reusable action.
While most core actions and steps fit common use cases, a Script step enables to execute a behavior that is not satisfied by the core steps.

The code of this script step is displayed <<submit_from_catalog_script_code, here>>.

As you can see it is very simple and the execution flow consists of:

. Instantiating the SchedulerClient Script Include
. Calling the submitFromCatalog function with the inputs as parameters
. Writing the result in the outputs variable

Finally, we define the outputs of the action with the same pills system, binding them to the step outputs.

.Outputs of the Submit From Catalog Action
image::servicenow-action-outputs.png[align="center"]

The concept is the same for all the application's Actions.

===== Flows

To put it simply, a flow is an automated process consisting of a sequence of actions and a trigger.
Flow building takes place in the Flow Designer application which requires a paid subscription to the Integration Hub application.

A Flow consists of the content types:

- Subflows: A Subflow is an automated process consisting of a sequence of reusable actions and specific data inputs that allow the process to be started from a flow, subflow, or script.
- Actions: An Action is a reusable operation that enables process analysts to automate Now Platform features without having to write code
- Core Actions: A ServiceNow Core Action is a ServiceNow-provided action available to any flow that cannot be viewed or edited from the Action Designer design environment.
For example, the Ask for Approval action

A trigger identifies what causes the flow to execute. +

Flows are triggered by:

- Record creation and/or update
- Date
- Service Catalog request
- Inbound email
- Service Level Agreements
- MetricBase (requires the MetricBase plugin)

NOTE: To access Flows, a user must have the flow_designer or admin roles.

The ProActive application come with Flows that can:

- Submit a job from the catalog asynchronously
- Restart in error tasks

Below is the "Submit job from catalog async" Flow

image::servicenow-flow.png[align="center"]

This Flow submits a job to ProActive's Scheduler in parallel, thus not blocking the main Flow thread.

In the Right panel named Data, you will find the data flow of the Flow. It offers a quick view of the Flow variables, accessible by all actions
and the inputs for each Action. Fo convenience, it has been cut in half in this screenshot.

image::servicenow-data-flow-flow-designer.png[align="center"]

The flow needs a trigger definition, and it will ready to run.

===== Workflows

The second way to automate complex processes is using Workflows that are built in the Workflow Editor.
A Workflow is the native way to do automation in ServiceNow. Workflow editor is intended for a more technical audience.

The goal and concepts of Workflows are the same as Flows only with a different interface and terminology.

Like Actions for Flows, a Workflow is a suite of Activities used for automating the processes.
Activities are the workflow blocks that carry out various tasks like sending emails, obtaining approvals, running scripts, and configuring field values on the records.

Every workflow starts with a Begin activity and ends with an End activity.
When the activity ends, the activity is available through the suitable node and the transition is comprehended to the latter activity.

Following are the ways to launch Workflows:

- UI Action
- Server-side script
- Triggered by field values on a record

The ProActive application comes with a set of activities ready to be used in your workflows.
Like the Actions in the Flows, they call the application's Script Include to perform their actions.

Each activity likely have inputs that needs to be defined.

Here the Login activity will read variables defined in the workflow's scratchpad.

image::servicenow-activity-variables.png[align="center"]

This window automatically opens when the activity is dragged and dropped on the canvas.

Use ProActive's custom activities from the Custom tab to integrate ProActive in your pipelines.

Here an example of a simple Workflow, that can be stored and used as a Sub Workflow, that Submits a job to ProActive from the Catalog

image::servicenow-workflow-example.png[align="center"]